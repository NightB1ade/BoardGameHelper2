---
title: Loading...
layout: game
---

<span>
	<img id="thumbnail">
	<table id="Parameters">
		<tr name="ExpansionButtons" class="buttons">
			<td colspan="2"></td>
		</tr>
		<tr name="NoPlayers"></tr>
		<tr name="Difficulty"></tr>
		<tr name="DisplayButtons" class="buttons">
			<td colspan="2"></td>
		</tr>
	</table>
</span>

<div id="GameInfo">
</div>




<script>
	var url = new URL(window.location.href);
	var bggid = url.searchParams.get("bggid");
	var json = {};

	var expansionCodesChecked = {};




	function Display() {
		var displayType = $("input[name='DisplayRadio']:checked").attr("displayType");
		var displayIndex = $("input[name='DisplayRadio']:checked").attr("displayIndex");

		expansionCodesChecked = $(".ExpansionCheckbox:checked").map(function() {
			return $(this).attr("expansionCode");
		}).get();

		var html = "";

		if (displayType == "TextSection") {
			var jsonSection = json.textSections[displayIndex];
			html = Display_TextSection(jsonSection);
		}

		$("#GameInfo").html(html);
	}




	function Display_TextSection(json) {
		var html = "";

		html += "<h1>" + json.mainHeader + "</h1>";

		json.subsections.forEach(function(value) {
			html += "<h2>" + value.subsectionHeader + "</h2>";
			if (value.bulletPoints != undefined) {
				html += "<ul>";
				value.bulletPoints.forEach(function(value) {
					if (
						value.expansionDisplayRules == undefined
						|| (
							(
								value.expansionDisplayRules.some(function(value) {
									return (
										expansionCodesChecked.includes(value.expansionCode)
										&& value.displayRule == false
									)
								}) == false
								&& value.expansionDisplayRules.some(function(value) {
									return (
										(
											value.expansionCode == "base"
											|| expansionCodesChecked.includes(value.expansionCode)
										)
										&& value.displayRule == true
									)
								})
							)
						)
					) {
						html += "<li>" + value.text + "</li>";
					}
				});
				html += "</ul>";
			}
		});

		return html;
	}




	$(document).ready(function() {
		//Get BGGAPI Data
		$.get(
			"{{ site.bggapi-thing }}" + bggid
			, function(data) {
				var item = $(data).find("items item");

				var name = $(item).find("name[type='primary']").attr("value");
				$("head title").html(name + " - {{ site.title }}");
				$("section#title h1").html(name);

				var img = $(item).find("thumbnail").text();
				$("img#thumbnail").attr("src", img);
			}
		);

		//Get JSON Data
		$.get(
				bggid + ".json"
				, function(data) {
					json = data;
				}
			)
			.done(function() {
				//Expansion Buttons
				var html_ExpansionButtons = "";

				if (json.expansions != undefined) {
					json.expansions.forEach(function(value) {
						html_ExpansionButtons += "<label for='ExpansionCheckbox_" + value.expansionCode + "'>" + value.expansionName + "</label>"
							+ " <input type='checkbox' class='ExpansionCheckbox' id='ExpansionCheckbox_" + value.expansionCode + "' expansionCode='" + value.expansionCode + "'" + ((value.default) ? " checked" : "") + ">";
					});
				}

				//Display Buttons
				var html_DisplayButtons = "";

				json.textSections.forEach(function(value, index) {
					html_DisplayButtons += "<label for='DisplayRadio_TextSection" + index + "'>" + value.mainHeader + "</label>"
						+ " <input type='radio' name='DisplayRadio' id='DisplayRadio_TextSection" + index + "' displayType='TextSection' displayIndex='" + index + "'>";
				});

				// Bind jQuery
				$("#Parameters tr[name='ExpansionButtons'] td").html(html_ExpansionButtons);
				$("#Parameters tr[name='DisplayButtons'] td").html(html_DisplayButtons);
				$("button").button();
				$("input[type=checkbox], input[type=radio]").checkboxradio({
					icon: false
				});
				// $(".spinner").spinner();

				// Bind onChange
				$("input[name='DisplayRadio'], input.ExpansionCheckbox").on("change", Display);
				$("select[name='Difficulty'], select[name='NoPlayers']").on("selectmenuchange", Display);
			});
	});
</script>
